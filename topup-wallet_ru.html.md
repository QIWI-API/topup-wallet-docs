---
title: Top-Up API QIWI Кошелька

search: true

metatitle: Top-Up API QIWI Кошелька

metadescription: Top-Up API QIWI Кошелька позволяет автоматизировать выплаты на QIWI Кошельки пользователей.

language_tabs:
  - xml: Примеры

toc_footers:
 - <a href='/'>На главную</a>
 - <a href='https://static.qiwi.com/business/qiwi_bank/clients/doc/paydealerprotocolint.pdf'>Документация PDF</a>
 - <a href='mailto:bss@qiwi.com'>Обратная связь</a>

includes:
 - topup-wallet/authorization_ru
 - topup-wallet/topup_ru
 - topup-wallet/topup-status_ru
 - topup-wallet/check-deposit_ru
 - topup-wallet/check-user_ru
 - topup-wallet/get-balance_ru
 - topup-wallet/errors_ru

---

# Общие сведения {#introduction}

###### [Редактировать на GitHub](https://github.com/QIWI-API/topup-wallet-docs/blob/master/topup-wallet_ru.html.md)

API выплат на кошельки предназначено для платежных агентов КИВИ Банк (АО), позволяет зачислять деньги на кошельки пользователей (балансы учетных записей клиентов в системе QIWI Wallet).

## Что позволяет протокол {#functions}

1. Переводить деньги клиентам сервиса QIWI Кошелек — запрос [pay](#payment).
2. Проверить текущий статус транзакции перевода — запрос [status](#status).
3. Проверять возможность проведения платежа — запрос [check-deposit-possible](#check-deposit).
4. Проверять существование клиентов в сервисе QIWI Кошелек — запрос [check-user](#check-user).
5. Следить за балансом на агентском счете для выплат — запрос [ping](#get-balance).

## Как это работает {#howitworks}

1. Пользователь передает вам сумму пополнения и номер QIWI Кошелька, который нужно пополнить.
2. Вы отправляете [запрос](#check-deposit) в Top-Up API QIWI Кошелька на проверку  возможности проведения платежа.
3. Вы отправляете [запрос](#payment) в Top-Up API QIWI Кошелька на пополнение этого кошелька.
4. Вы [проверяете](#status) текущий статус платежа. Платеж должен принять [финальный статус](#statuses).
5. При успешном финальном статусе платежа средства автоматически перечисляются на баланс кошелька пользователя с вашего агентского счета.
6. При неуспешном финальном статусе платежа вы возвращаете средства клиенту.

По вопросам интеграции и сотрудничества пишите на <a href="mailto:bss@qiwi.com">bss@qiwi.com</a>.

# Формат взаимодействия {#general}

Взаимодействие происходит посредством пересылки запросов и ответов на них системы QIWI Wallet. Запросы и ответы – XML-документы в кодировке UTF-8.

В API используются только  HTTP POST-запросы, XML-документ помещается в теле HTTP-запроса. Используется только HTTPS-протокол.

[Справка по формату значений](#params-types) тегов и атрибутов XML.

<aside class="warning">
Описанные в документации теги и атрибуты запросов/ответов обязательны для передачи (если в описании конкретного тега или атрибута не указано иное). Добавление дополнительных тегов или атрибутов в ответы или запросы не является нарушением протокола. Следите за обновлениями протокола на Github.
</aside>

Запросы в производственной среде отправляются по протоколу HTTPS на URL:

`https://api.qiwi.com/xml/topup.jsp`

При использовании аутентификации [по клиентскому сертификату](#ssl-auth) запросы в производственной среде отправляются по протоколу HTTPS на URL:

`https://private-api.qiwi.com/xml/topup.jsp`

Необходимо проверять подлинность сервера QIWI с помощью цепочки сертификации и не устанавливать соединение, если проверка не пройдет успешно.

Аутентификация запросов выполняется по логину и паролю, помещаемым в XML-тегах `terminal-id` и `extra name="password"`, соответственно. Логин и пароль выдаются при подключении к системе QIWI Wallet. Смена пароля выполняется через сотрудников КИВИ Банк (АО) или сотрудников уполномоченного представителя КИВИ Банк (АО).

Для повышения безопасности информационного обмена также может использоваться аутентификация [по цифровой подписи](#sign-auth) или [по клиентскому сертификату](#ssl-auth).

Единственным признаком, на основе которого вы можете принимать решение о успешности или неуспешности выполнения платежа на своей стороне, является статус транзакции в системе QIWI Wallet. Как только вы получили для вашего платежа идентификатор транзакции `txn_id` в системе QIWI Wallet, вы можете проверить статус транзакции методом [Проверка статуса платежа](#status).

<aside class="warning">Несмотря на то, что протокол является идемпотентным, наиболее достоверный и рекомендуемый способ получения финального статуса - реализация метода <a href="#status">"Проверка статуса платежа"</a></aside>

Каждому платежу (набору реквизитов: сумма, валюта, идентификатор клиента в системе QIWI Wallet, идентификатор сервиса) вы должны присваивать уникальный идентификатор.

Сценарий пополнения QIWI Кошелька отображен на диаграмме:

<div class="mermaid">
sequenceDiagram
participant Agent as Агент
participant qb as Система QIWI Wallet
Agent->>qb:Проверка возможности<br>проведения платежа<br>(запрос "check-deposit-possible")
qb->>Agent:Ответ
alt Проведение платежа возможно
Agent->>qb:Пополнение учетной записи Клиента<br>(запрос "pay")
qb->>qb:Создание кошелька <br>при отсутствии учетной записи
qb->>Agent:Ответ (статус платежа или ошибка)
Agent->>Agent:Финальный статус платежа?
alt Если финальный статус не получен
loop Цикл до получения финального статуса
Agent->>qb:Проверка статуса платежа пополнения<br>(запрос "status")
qb->>Agent:Ответ (текущий статус платежа)
end
end
alt Успех / Финал
qb->>qb:Зачисление средств на кошелек Клиента
end
alt Неуспех / Финал
Agent->>Agent:Возврат средств Клиенту
end
end
</div>

Логическая последовательность операций при взаимодействии с системой QIWI Wallet должна соответствовать блок-схеме:

<div class="mermaid">
graph TB
ST(Начало пополнения учетной записи Клиента) --> A
A[Проверка возможности проведения платежа] --> B{Проведение<br>платежа<br>возможно?}
B -->|да| C{Учетная запись<br>существует?}
B -->|нет| G[[Платеж НЕ проведен]]
C -->|нет| H{Создать Клиента<br>и зарегистрировать платеж?}
C -->|да| K
H -->|да| K[Пополнение учетной записи Клиента]
H -->|нет, если Клиент не найден,<br>то платеж не проводить| G
K -->KN{Сетевая ошибка?}
KN & KER -->|да| KW([Ожидание >= 10 минут])
KER -->|нет| PFS
KN -->|нет| KER{Ошибка обработки запроса?}
PFS -->|final-status=true| RS{Атрибут status?}
PFS -->|final-status=false| MR
KW --> MR[Проверка статуса платежа]
RS -->|> 100| G
RS -->|=60| X[[Платеж проведен]]
MR --> MER{Сетевая ошибка?}
MER -->|нет| MW{Ошибка обработки запроса?}
MW & MER -->|да| KW
MW -->|нет| PT{В ответе есть<br>тег payment с<br>номером транзакции txn_id?}
PT -->|да| PFS{Атрибут final-status?}
PT -->|нет| KW
</div>
